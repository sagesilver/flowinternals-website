
# FlowInternals Project Rules

1. Modular, Component-First Architecture
   - Break pages into reusable UI components (header, footer, paywall wrapper, course card).
   - New products/pages slot in without touching unrelated code.

2. Semantic Versioning & Branching Strategy
   - MAJOR.MINOR.PATCH versioning.
   - Feature branches with PRs for all changes.

3. Mandatory Code Reviews & PR Checklist
   - At least one reviewer per PR.
   - Checklist: tests added/updated, linter/type checks pass, performance impact assessed, paywall gating verified.

4. Automated Test Suite & Coverage Guardrails
   - Unit tests for components/utilities.
   - Integration tests for paywall and purchase flows.
   - E2E tests (Cypress/Playwright) for login and checkout.
   - Enforce ≥ 80% coverage; block CI on drops.

5. Continuous Integration / Continuous Deployment
   - CI runs lint, type-check, tests, build, deploy to staging.
   - Only green builds auto-deploy to production.

6. Feature Flags for Paywalled Content
   - Wrap new course pages behind toggles.
   - Default OFF in prod; enable post-QA.

7. Regression Detection & Canary Releases
   - Visual-diff/snapshot tests for UI.
   - 5% canary rollout for major changes; monitor errors before full release.

8. Performance Budget & Bundling Rules
   - Max page bundle ≤ 200 KB gzipped.
   - Code-splitting by page.
   - CI Lighthouse audit; block PRs below threshold.

9. Strict Linting, Formatting & Type Safety
   - ESLint + Prettier; strict TypeScript.
   - CI fails on lint or type errors.

10. Automated Accessibility Checks
    - axe-core or pa11y in CI; block new critical violations.

11. Refactoring & Tech-Debt Policy
    - Reserve 1 day/sprint for tech-debt tickets.
    - Components > 200 LOC trigger refactor before new features.

12. Comprehensive Documentation
    - Living docs: Storybook for UI, Markdown for dev-ops.
    - Update docs alongside code; PRs highlight doc changes.

13. Environment Parity & Secret Management
    - Staging mirrors prod (DB schema, config).
    - Store secrets in vault/CI; never in code.

14. Monitoring, Logging & Alerting
    - Real-user monitoring (Sentry/Datadog).
    - Log/paywall and purchase errors; alert on spikes.

15. Rollback & Backup Plan
    - Auto-rollback on uncaught prod errors.
    - Nightly backups of DB/static assets; monthly restore tests.

